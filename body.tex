\section{Introduction}
In order to sucessfully comission the Vera C. Rubin Observatory and begin the Legacy Survey of Space and Time (LSST) we need to be able to perform astrometric and photometric calibrations of individual visits. 
These calibrations will be done within the Rubin Science Pipelines by comparing instrumental measurements of fluxes and positions to those in a reference catalog and deriving zeropoints/corrections to the wcs. 
The science requirements for relative photometric precision \citep[OSS-REQ-0387;][]{LSE-30} are defined as the RMS of repeated measurements of unresloved sources must be, at a miniumum, less than 8 mmag (12 mmag) for gri-band (uzy-band) observations. 
Additionally, the requirements for the astrometric quality of data are defined in OSS-REQ-038 are such that the RMS on the distance between pairs of sources must be less than 10 milli-arcseconds, with an error on the accuracy of less than 50 mas in any axis. 
To meet these requirements we need a reference catalog with the following features:

\begin{itemize}
    \item The catalog must cover any location we will want to point the telescope. 
    This includes the full sky with declination < 30 deg, althogh we have generated an all-sky catalog. 
    \item There must be flux estimates in all bandpasses, \textit{ugrizy} for LSSTCam and \textit{grizy} for LATISS. 
    \item The number density of un-saturated high-signal to noise sources must be high enough to calibrate a single LSSTCam CCD. 
    This requires there to be at least 10 reference sources per \texttt{NSIDE}=256 healpixel on the sky.
    The size of a detector on the sky is $\sim 0.05\,\mathrm{deg}^2$  equal to that of an \texttt{NSIDE}=256 healpixel. 
    \item High precision measurements of the positions of unresolved sources. 
    This is achived by using \textit{Gaia}-DR3 as the basis for the objects in our catalog with full position and proper motion measurements included. 
    
\end{itemize} 

Previous catalogs such as ATLAS-REFCAT2 \citep{Tonry:2018} provide the all-sky coverage, but are not sufficently deep to provide the required source density. 
PANSTAARS1\citep[PS1;][]{Chambers:2016} provides the depth in \emph{grizy}-bands but not the \emph{u}-band or the sky coverage below a declination of $\delta = -30$ deg. 
Additionally, we would like our reference catalog to provides fluxes in the LSSTCam bandpasses. 
Therefore we have developed \monster, a combination of reference catalogs similar to ATLAS-REFCAT2 but with the bandpass coverage and depth required to enable LSST. 

The code and configuration used to create \monster can be found at \url{https://github.com/lsst-dm/the_monster}\\

\textbf{Note:} In this document we use \emph{source} to describe the bandpass a measurment is currently in and \emph{target} to describe the bandpass we would like to transform a measurement into. 

In this document we describe how to access \monster in section \ref{sec:using}, section \ref{sec:summary} summarizes the creation of this catalog. Then, we discuss in more detail the input datasets (\ref{sec:input}), the 
conversion of external refcats to the LSST format (\ref{sec:conversion}), derivations of the color transfomations (\ref{sec:colors}), the stellar locus regression (slr) method used to derive many of the \emph{u}-band fluxes. 
Then, in section \ref{sec:assembly} we present the assembly of \monster including characterizing of version 1 of this catalog. 
Finally, we include more detailed descriptions of each of the input catalogs for \monster in section \ref{sec:details}. 

\section{Using \monster}
\label{sec:using}
Version 1 of \monster  has been added as a reference catalog to most of the repos at usdf and the summit. 
To access this catalog from the butler use
$$\texttt{datasetType="the\_monster\_20240904"}$$ 
with the chained collection \texttt{"refcats"} or the run collection \texttt{"refcats/DM-46370/the\_monster\_20240904"}. 
For each bandpass in \monster there are three columns: 
\begin{itemize}
    \item \texttt{monster\_\{system\}\_\{band\}\_flux} 
    \item \texttt{monster\_\{system\}\_\{band\}\_fluxErr} 
    \item \texttt{monster\_\{system\}\_\{band\}\_source\_flag}.
\end{itemize}

The systems and bands included are:
\begin{itemize}
    \item DES: grizy
    \item SDSS: u
    \item LATISS: grizy
    \item SynthLSST: ugrizy.
\end{itemize}

The flat files for \monster in fits format can be accessed at the usdf at the location
$$\texttt{path=/sdf/group/rubin/shared/refcats/the\_monster\_20240904/}$$


\section{Summary of creation of \monster}
\label{sec:summary}
The creation of the \monster can divided into two components, the \textit{grizy}-bands and the \textit{u}-band. 


\subsection{\textit{grizy-bands}}
\begin{enumerate}
    \item For each input reference catalog, we retrieve a version containing only high-quality stellar sources. This process is generally described in Section \ref{sec:input} and details for each external input refcat are discussed in Section \ref{sec:details}
    \item Subsequently, all input catalogs are converted into the LSST refcat format (htm7), see Section \ref{sec:conversion}.
    \item Our reference catalog, \monster, uses DES bandpasses internally for \textit{grizy}-bands. So, the next step is to convert all measured fluxes to the DES system by derving color transformations. 
    This is done by fitting a cubic spline to the ratio of source flux and target flux as a function of color for a high quality subset of the data over a restricted color range.
    \item With the external reference catalogs in hand, as well as colorterms for each measurement, we next create versions of each refcat that have been matched to \textit{Gaia\_DR3} sources, further selected to only include isolated sources (no neighbors within 1"), and transformed to the DES bandpass.
    \item Finally, we assemble \monster by reading in each transformed htm shard and adding measurements for each \textit{Gaia\_DR3} (a rank order of preference is used when multiple refcats have measurements of the same source) to the\_monster catalog. We add flux measurements for the DES-bandpasses as well as any target bandpasses for the\_monster catalog. In version one of the\_monster, \textit{the\_monster\_20240904}, LATISS fluxes and synthLSST fluxes are included as well.
\end{enumerate}

\subsection{u-band}
For the \textit{u}-band, the creation process is similar with a few notable exceptions:
\begin{itemize}
    \item The internal system is SDSS \textit{u}-band.
    \item Gaiaxp tied to SDSS \textit{u}-band as described in the section.
    \item We use a stellar locus regression-based method to transform DES \textit{g}-band fluxes and \textit{g-r} colors into SDSS \textit{u}-band measurements.
\end{itemize}

\section{Input Data}
\label{sec:input}
Here we describe the input catalogs used for the creation of \monster. 
%For each catalog, we include the origin, any cuts applied, and summary plots of the spatial distributions. 
The photometric catalogs used in this process for the \emph{grizy}-bands are (in order of priority):
\begin{enumerate}
    \item DES Y6 Calibration Stars (\ref{sec:des})
    \item Gaia XP Synthetic Magnitudes (\ref{sec:gaiaxp})
    \item PS1 (\ref{sec:ps1})
    \item SkyMapper (\ref{sec:skymapper})
    \item VST (\ref{sec:vst})
\end{enumerate}

For \textit{u}-band we use:
\begin{itemize}
    \item SDSS Standard Stars (\ref{sec:sdss})
    \item Gaia XP Synthetic Magnitudes (\ref{sec:gaiaxp})
    \item Stellar Locus Regression-based magnitudes (\ref{sec:slr})
\end{itemize}

\section{Catalog conversion}
\label{sec:conversion}
To convert the catalogs into LSST format, we follow the instructions on \href{https://pipelines.lsst.io/modules/lsst.meas.algorithms/creating-a-reference-catalog.html}{pipelines.lsst.io} on how to generate an LSST reference catalog using the \href{https://pipelines.lsst.io/modules/lsst.meas.algorithms/tasks/lsst.meas.algorithms.ConvertReferenceCatalogTask.html#lsst-task-lsst-meas-algorithms-convertreferencecatalog-convertreferencecatalogtask}{ConvertReferenceCatalogTask}. Each refcat requires its own configurations, which can be found in the \href{https://github.com/lsst-dm/the_monster/tree/main/configs}{configs folder of the\_monster github repo}.
This conversion process shards the catalog into htm=7 trixels and creates a set of standard columns that include ra/dec coordinates as well as fluxes and errors in units of nJy.

\section{Color Transformations}
\label{sec:colors}
Additionally, for PS1, we found a magnitude-dependent offset that has been fit as well. The Colorterms section describes these fits in more detail.
There are a number of
\subsection{To DES Bandpasses}
\begin{figure}
    \includegraphics[width=0.49\linewidth]{./figures/color_terms/GaiaXP_to_DES_band_g_color_term.png}
    \includegraphics[width=0.49\linewidth]{./figures/color_terms/GaiaXP_to_DES_band_g_flux_residuals.png}
    \caption{Left: The ratio of fluxes between GaiaXP synthetic photometry and DES for the \textit{g}-band as a function of \textit{g-i} color. The red line shows the cubic spline that defines our color transformation.
    Right: Residuals between GaiaXP synthetic photometry transformed to DES and DES as a function of magnitude.}
\end{figure}
\subsection{To Synthetic LSST Bandpasses}
\subsection{To LATISS Bandpasses}
\subsection{To SDSS \textit{u}-band}

\section{Stellar Locus Regression for the \textit{u}-band}
\label{sec:slr}

\section{Assembly of the\_monster v1}
\label{sec:assembly}

\input{monster_maps}

\section{Detailed Descriptions}
\label{sec:details}
In the following subsections, we describe the external photometric catalogs used in the creation of the\_monster.

\subsection{Dark Energy Survey (DES) Y6 Calibration Stars}
\label{sec:des}
Data is described in \href{https://arxiv.org/abs/2305.01695}{Rykoff et al 2023}. Briefly, this is a catalog of calibrated reference stars generated by the Forward Calibration Method (FGCM) pipeline (arXiv:1706.01542) as part of the FGCM photometric calibration of the full Dark Energy Survey (DES) 6-Year data set (Y6). This catalog provides DES \textit{grizY} magnitudes for 17 million stars with \textit{i}-band magnitudes mostly in the range 16 < \textit{i} < 21, spread over the full DES footprint covering 5000 square degrees over the Southern Galactic Cap at galactic latitudes \textit{b} < -20 degrees (plus a few outlying fields disconnected from the main survey footprint). These stars are calibrated to a uniformity of better than 1.8 milli-mag (0.18\%) RMS over the survey area. The absolute calibration of the catalog is computed with reference to the STISNIC.007 spectrum of the Hubble Space Telescope CalSpec standard star C26202; including systematic errors, the absolute flux system is known at the approximately 1\% level. These stars provide a useful reference catalog for calibrating \textit{grizY}-band or \textit{grizY}-like band photometry in the Southern Hemisphere, particularly for observations within the DES footprint.

The data was retrieved from \url{https://data.darkenergysurvey.org/public_calib/DES_6yr_CalibStarCat/Y6A1_FGCM_V3_3_1_PSF_ALL_STARS.fits} on May 2nd, 2023.

Data page is at \url{https://des.ncsa.illinois.edu/releases/other}

\subsubsection{Color transformations}
The DES bandpasses act as the internal bandpasses for \monster and 

\subsection{Gaia XP Synthetic Magnitudes}
\label{sec:gaiaxp}
This catalog contains synthetic fluxes/magnitudes for stars in the following passbands:
PS1std-grizy, PS1-grizy, DECam-grizY, SDSSstd-ugriz (and non-std), SkyMapper-u2uvgriz

Photometry was generated from Gaia DR3 XPSpectra \href{https://arxiv.org/abs/2206.06215}. 

This was done using GaiaXPy \href{https://github.com/gaia-dpci/GaiaXPy/cd}.

\subsection{PanSTARRS1 (PS1)}
\label{sec:ps1}
\url{/sdf/group/rubin/datasets/refcats/htm/v1/ps1_pv3_3pi_20170110/README.txt}

This reference catalog, intended for use with the LSST Science Pipelines \href{https://pipelines.lsst.io} was constructed from the "3pi.pv3.20160422" DVO catalog of Processing Version 3 of the Pan-STARRS1 3pi survey, released to the Pan-STARRS1 Science Consortium. Following the public release of this data in December 2016 \href{http://panstarrs.stsci.edu}, you may distribute this catalog freely.

This format of the catalog contains 2,990,470,528 point sources at Dec > -30 deg to i ~ 22.5 mag, and has a total size of 423 GB. 

Relevant papers for information and citation include: \citet{Chambers:2016}

\subsection{SkyMapper}
\label{sec:skymapper}
\subsection{VST}
\label{sec:vst}

VST ATLAS DR4 downloaded from ESO archive.

Documentation can be found at: \url{http://www.eso.org/rm/api/v1/public/releaseDescriptions/90}

Skim to healpixels was done with the following criteria:
\begin{verbatim}
sel = (dat["MERGEDCLASS"] == -1)  # stars
sel &= (dat["PRIORSEC"] == 0)     # unique source 
sel &= (dat["PRIMARY_SOURCE"] == 1) # primary source 
sel &= (dat["UERRBITS"] < 0)      # no u-band processing flags
\end{verbatim}

\subsection{GAIA DR3 - The Astrometric Reference}
\label{sec:gaiadr3}
Original data: \url{https://www.cosmos.esa.int/web/gaia/dr3}

The full Gaia DR3 catalog in indexed HTM format. This is the first LSST refcat to contain the full coordinate covariance.

Magnitude range: $\sim$3 - 21 (G magnitude)

\subsection{SDSS}
\label{sec:sdss}


% \section*{Methods}

% \subsection*{grizy-bands}
% \begin{enumerate}
%     \item Cross-match each catalog to Gaia DR3 (after some isolation cuts).
%     \item Use the Gaia/DES cross-match stars as the overall cross-calibration reference.
%     \item For each catalog, compute an empirical correction to go from Catalog X to DES. This uses the cross-coverage. The empirical correction will be some sort of spline fit (TBD) to apply to stars across a broad range of colors. We will also allow for a "background offset" term (to account for offsets as a function of flux due to background issues).
%     \item Apply the empirical correction to convert Catalog X to DES bands for the full catalog.
%     \item Convert from DES to LSSTCam (sim for now) using a stellar template library. When we have real data (throughputs, stars, both), we can update this conversion all at once.
%     \item Choose a catalog rank-ordering (e.g., DES, Gaia XP, PS1, SkyMapper, etc.).
%     \item For each star with band X, choose the top-ranked catalog with a measurement in that band.
% \end{enumerate}

% \subsection*{u-band}
% \begin{enumerate}
%     \item XP (SDSS) \textit{g-r/u} to SDSS \textit{u} correction, with a northern training region at high latitude.
%     \item DES \textit{g-r} to corrected XP corrected SDSS \textit{u} over DES training region at high latitude.
%     \item Over the full Monster footprint, estimate SDSS SLR \textit{u} for all stars where we have a \textit{g-r} color estimate (DES equivalent).
%     \item Over the full Monster footprint, at low resolution, estimate the offset between the XP corrected SDSS \textit{u} and the SLR \textit{u}.
%     \item Use bilinear interpolation to correct the SLR \textit{u} to the XP \textit{u} so everything will be well matched.
% \end{enumerate}


